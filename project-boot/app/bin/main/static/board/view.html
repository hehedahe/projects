<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<title>Board</title>
</head>
<body>

<h1>Post details</h1>
<div>
  <label>글 번호</label>
  <input type="number" name="index" readonly>
</div>
<div>
    <label>제목</label>
    <input type="text" name='title' size="50" value="새로운 할 일">
</div>
<div>
  <label>작성일</label>
  <input type="date" name='date' size="50" readonly>
</div>
<div>
    <label>내용</label>
    <textarea name='content' cols="60" rows="5"></textarea>
</div>
<button id="x-update-btn" type="button">변경</button>
<button id="x-delete-btn" type="button">삭제</button>
<button id="x-cxl-btn" type="button">취소</button>

<script type="text/javascript">

  var arr = location.href.split("?");
  console.log(arr);

  if (arr.length == 1) {
    alert("요청 형식이 옳바르지 않습니다.")
    throw "url 형식 오류!";
  }

  var qs = arr[1];
  console.log(qs);

  var params = new URLSearchParams(qs);
  var index = params.get("index");
  console.log(index);
  if (index == null) {
    alert("번호 값이 없습니다.")
    throw "파라미터 오류! ";
  }

  var xIndex = document.querySelector("input[name='index']");
  var xTitle = document.querySelector("input[name='title']");
  var xDate = document.querySelector("input[name='date']");
  var xContent = document.querySelector("textarea");

  fetch(`/board/get?index=${index}`)
    .then(function(response) {
      return response.json();
    })
    .then(function(post) {
      console.log(post);
      xIndex.value = parseInt(index) + 1;
      xTitle.value = post.title;
      xContent.value = post.content;
      xDate.value = post.createdDate;
    });

  document.querySelector("#x-update-btn").onclick = function() {
    if (xTitle.value == "" || xContent.value == "") {
      window.alert("필수 입력 항목이 비어 있습니다.");
      return;
    };

    fetch(`/board/update?index=${index}&title=${xTitle.value}&content=${xContent.value}&createdDate=${xDate.value}`)
      .then(function(response) {
        return response.text();
      }).then(function(text) {
        location.href = "index.html";
      });
  };

  document.querySelector("#x-cxl-btn").onclick = function() {
    window.location.href = "index.html"
  };

  document.querySelector("#x-delete-btn").onclick = function() {
    fetch(`/board/delete?index=${index}`)
      .then(function(response) {
        return response.json();
      })
      .then(function(result) {
        console.log(result);
        location.href = "index.html";
      });
  };

  xContent.onkeyup = function(e) {
    console.log(xContent.innerHTML);
    if (e.keyCode == 27) { // ESC 키를 눌러 편집을 취소한다면
      var result = confirm("내용이 수정되었습니다. 수정하시겠습니까?");
      if (result) {
          if (xTitle.value == "" || xContent.value == "") {
            window.alert("필수 입력 항목이 비어 있습니다.");
            return;
          }
          fetch(`/board/update?index=${index}&title=${xTitle.value}&content=${xContent.value}&createdDate=${xDate.value}`)
            .then(function(response) {
              return response.text();
            }).then(function(text) {
              location.href = "index.html";
            });
        }
        location.href = "index.html"
      }
    }



















</script>
</body>
</html>
